{
    "$schema": "https://railway.app/railway.schema.json",
    "build": {
      "builder": "nixpacks",
      "config": {
        "environment": {
          "PIP_MEMORY_LIMIT": "512",
          "PIP_NO_CACHE_DIR": "1",
          "TORCH_CUDA_VERSION": "none"  
        },
        "aptPackages": [
          "libgl1-mesa-glx",
          "libsm6",
          "libxrender1",
          "libxext6",
          "libglib2.0-0" 
        ],
        "scripts": {
          "preInstall": "apt-get update && apt-get install -y python3-dev", 
          "postInstall": "pip install --no-cache-dir torch==2.0.1+cpu --index-url https://download.pytorch.org/whl/cpu && pip install --no-cache-dir -r requirements.txt"
        }
      }
    },
    "deploy": {
      "startCommand": "gunicorn --workers 2 --threads 4 --bind 0.0.0.0:$PORT --timeout 120 app:app"
    }
  }