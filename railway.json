{
    "$schema": "https://railway.app/railway.schema.json",
    "build": {
      "builder": "NIXPACKS",
      "nixpacksPlan": {
        "providers": {
          "apt": {
            "packages": [
              "libgl1-mesa-glx",
              "libsm6",
              "libxrender1",
              "libxext6",
              "ffmpeg",
              "python3-dev",
              "build-essential",
              "pkg-config"
            ]
          }
        },
        "phases": {
          "setup": {
            "commands": [
              "apt-get update -qq",
              "apt-get install -y --no-install-recommends"
            ]
          },
          "install": {
            "runtimeEnv": {
              "PIP_MEMORY_LIMIT": "512",
              "PIP_NO_CACHE_DIR": "1",
              "SKIP_PIP_PROBLEMATIC_PACKAGES": "1"
            },
            "commands": [
              "pip install --no-cache-dir --only-binary=:all: torch==1.13.0+cpu torchvision==0.14.1+cpu --index-url https://download.pytorch.org/whl/cpu",
              "pip install --no-cache-dir -r requirements.txt"
            ]
          }
        }
      }
    },
    "deploy": {
      "startCommand": "gunicorn --bind 0.0.0.0:$PORT --workers 1 --threads 2 --timeout 300 app:app"
    }
  }